######
# title: "Homework1_Part1"
# output: html_document
######

```{r}

#simplier code for matching and data matching and sorting.
#add pig_right, right, left, top data in to data.scr, so that original data wouldn't lost
#add visulization
library('stringr')
d <- readLines("~cr173/Sta523/data/world_cup_goals_raw.txt")
c_name<-str_match_all(d[1]," ([a-z]*)=")#extract column names
c_name.sorted<-c_name[[1]][,2][c_name[[1]][,2][]!="pteamimg"]#c_name.sorted becomes an atomic vector
numc=length(c_name.sorted)#better not to name number of column as ncol, since it is parameter name of matrix. 
#must create a new data.frame, otherwise will report error
dat <- matrix(data=NA,nrow=length(d),ncol=numc)
dat <- data.frame(dat)
#extract all raw data
flag.na=rep(F,length(d))#rule out NA rows

for (i in 1:numc)
  {
  con=str_match(d,paste(" ",c_name.sorted[i],"=\"([^\"]*)\"",sep=""))#str_match return a matrix, instead of a list, easier to manipulate
  dat[i]=con[,2]
  attr(dat,"names")[i]=c_name.sorted[i]
  flag.na=flag.na|is.na(dat[[i]])
  }
numc=numc+1L

ispen=str_match(dat[["class"]],"ispen")
flag.ispen=!is.na(ispen)
owngoal=str_match(dat[["ptype"]],"Own goal")
flag.owngoal=!is.na(owngoal)
#rule out all data not satisfying requirment
flag=!(flag.na|flag.ispen|flag.owngoal)
dat.scr=dat[flag,]

#pre-processe pig, right, left, and top; and time
pig_right=550-as.double(dat.scr[["pig"]])
leftc=str_match(dat.scr[["style"]],"left: ([0-9]*)px")#character matrix
left=as.double(leftc[,2])#double matrix
rightc=str_match(dat.scr[["style"]],"right: ([0-9]*)px")
right=as.double(rightc[,2])
topc=str_match(dat.scr[["style"]],"top: ([0-9]*)px")
top=as.double(topc[,2])

right[!is.na(left)]=1000-left[!is.na(left)]#make right column complete because of the pig_right
dis=sqrt((right-pig_right)^2+top^2)

dat.scr[["ptime"]]=as.double(dat.scr[["ptime"]])

#attr(dat.scr,"names")[numc]="pig_right" #could get error
dat.scr["pig_right"]=pig_right #automattically bind a column on the end of dat.scr with given name.

numc=numc+1L 

#attr(dat.scr,"names")[numc]="right"
dat.scr["right"]=right

numc=numc+1L

#attr(dat.scr,"names")[numc]="left"
dat.scr["left"]=left

numc=numc+1L

#attr(dat.scr,"names")[numc]="top"
dat.scr["top"]=top

numc=numc+1L

#attr(dat.scr,"names")[numc]="dis"
dat.scr["dis"]=dis

numc=numc+1L

#Visulization of distance goals travel v.s. time, with goaler's name and national flag as background.
ge<-which(dat.scr["pteam"]=="Germany")
ar<-which(dat.scr["pteam"]=="Argentina")
ne<-which(dat.scr["pteam"]=="Netherlands")
br<-which(dat.scr["pteam"]=="Brazil")

library(png)
par(mfrow=c(2,2))
#Germany
geimg<-readPNG("GeT.png")
op<-par(ps=10)
plot(dat.scr[["ptime"]][ge], dat.scr[["dis"]][ge],ylim=c(0,max(dat.scr[["dis"]][ge])*1.1),xlab="Time (minutes)", ylab="Distance of goal",main="Germany")
lim <- par()
rasterImage(geimg, lim$usr[1], lim$usr[3], lim$usr[2], lim$usr[4])
#grid()
points(dat.scr[["ptime"]][ge],dat.scr[["dis"]][ge],pch=21, col=1, bg=2)
segments(x0=dat.scr[["ptime"]][ge], y0=dat.scr[["dis"]][ge], y1=0, col=8)

#Argentina
arimg<-readPNG("ArT.png")
op<-par(ps=10)
plot(dat.scr[["ptime"]][ar], dat.scr[["dis"]][ar],ylim=c(0,max(dat.scr[["dis"]][ar])*1.1),xlab="Time (minutes)", ylab="Distance of goal",main="Argentina")
lim <- par()
rasterImage(arimg, lim$usr[1], lim$usr[3], lim$usr[2], lim$usr[4])
#grid()
points(dat.scr[["ptime"]][ar],dat.scr[["dis"]][ar],pch=21, col=1, bg=2)
segments(x0=dat.scr[["ptime"]][ar], y0=dat.scr[["dis"]][ar], y1=0, col=8)

#Netherland
neimg<-readPNG("NeT.png")
op<-par(ps=10)
plot(dat.scr[["ptime"]][ne], dat.scr[["dis"]][ne],ylim=c(0,max(dat.scr[["dis"]][ne])*1.1),xlab="Time (minutes)", ylab="Distance of goal",main="Netherland")
lim <- par()
rasterImage(neimg, lim$usr[1], lim$usr[3], lim$usr[2], lim$usr[4])
#grid()
points(dat.scr[["ptime"]][ne],dat.scr[["dis"]][ne],pch=21, col=1, bg=2)
segments(x0=dat.scr[["ptime"]][ne], y0=dat.scr[["dis"]][ne], y1=0, col=8)

#Brazil
brimg<-readPNG("BrT.png")
op<-par(ps=10)
plot(dat.scr[["ptime"]][br], dat.scr[["dis"]][br],ylim=c(0,max(dat.scr[["dis"]][br])*1.1),xlab="Time (minutes)", ylab="Distance of goal",main="Brazil")
lim <- par()
rasterImage(brimg, lim$usr[1], lim$usr[3], lim$usr[2], lim$usr[4])
#grid()
points(dat.scr[["ptime"]][br],dat.scr[["dis"]][br],pch=21, col=1, bg=2)
segments(x0=dat.scr[["ptime"]][br], y0=dat.scr[["dis"]][br], y1=0, col=8)

```



