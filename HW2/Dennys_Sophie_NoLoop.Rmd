---
title: "Dennys_noLoop"
author: "Sophie Lee"
date: "October 1, 2014"
output: html_document
---

As explained in the blog, Denny's location finder allows 3000miles of radius. So, I searched the stores on the West Coast and the East Coast just like the blogger did.
After running the following codes, you get the data with longitude and latitudes of the Denny's restaurants in the US. The name of the data is "data" here.

```{r}



## load required packages

check_packages = function(names)
{
  for(name in names)
  {
    if (!(name %in% installed.packages()))
      install.packages(name, repos="http://cran.us.r-project.org")
    
    library(name, character.only=TRUE)
  }
}

check_packages(c("httr","XML","sp","stringr","jsonlite","rgeos","maptools", "rgdal","ggplot2","spatsta","jsonlite","stringr"))





dir.create("json/", showWarnings = FALSE)
key="8D6F0428-F3A9-11DD-8BF2-659237ABAA09"

########## Round 1


name="UT"    

url = paste0("http://hosted.where2getit.com/dennys/ajax?&xml_request=%3Crequest%3E%3Cappkey%3E",
             key,
             "%3C%2Fappkey%3E%3Cformdata+id%3D%22locatorsearch%22%3E%3Cdataview%3Estore_default%3C%2Fdataview%3E%3Climit%3E3000%3C%2Flimit%3E%3Cgeolocs%3E%3Cgeoloc%3E%3Caddressline%3E,%20",
             name,
             "%3C%2Faddressline%3E%3Clongitude%3E%3C%2Flongitude%3E%3Clatitude%3E%3C%2Flatitude%3E%3C%2Fgeoloc%3E%3C%2Fgeolocs%3E%3Csearchradius%3E3000|10000%3C%2Fsearchradius%3E%3C%2Fformdata%3E%3C%2Frequest%3E")   

d=GET(url)
stopifnot(d$status_code == 200)

# Clean up jQuery wrapper to get valid json
s = content(d, as="text")
#     s=as.matrix(as.data.frame(s))
#     s=str_replace(s, "<", " ")
# city=as.data.frame(str_match_all(s,"city>([A-Z]*)</"))
# address = as.data.frame(str_match_all(s, "address1>([0-9 A-Z]*)</address1"))
lat=as.data.frame(str_match_all(s,"latitude>([0-9.0-9]*)</latitude"))
long=as.data.frame(str_match_all(s,"longitude>(-[0-9.0-9]*)</longitude"))
# phone=as.data.frame(str_match_all(s,"phone>([0-9]*)</phone"))
lat=lat[,2]
lat=as.data.frame(lat)
long=long[,2]
long=as.data.frame(long)
data.UT=cbind(lat=lat, long=long)

# Save the file locally
file = paste0("json/",name,".json")
write(s, file=file)





########## Round 2


name="DC"    

url = paste0("http://hosted.where2getit.com/dennys/ajax?&xml_request=%3Crequest%3E%3Cappkey%3E",
             key,
             "%3C%2Fappkey%3E%3Cformdata+id%3D%22locatorsearch%22%3E%3Cdataview%3Estore_default%3C%2Fdataview%3E%3Climit%3E3000%3C%2Flimit%3E%3Cgeolocs%3E%3Cgeoloc%3E%3Caddressline%3E,%20",
             name,
             "%3C%2Faddressline%3E%3Clongitude%3E%3C%2Flongitude%3E%3Clatitude%3E%3C%2Flatitude%3E%3C%2Fgeoloc%3E%3C%2Fgeolocs%3E%3Csearchradius%3E3000|10000%3C%2Fsearchradius%3E%3C%2Fformdata%3E%3C%2Frequest%3E")   

d=GET(url)
stopifnot(d$status_code == 200)

# Clean up jQuery wrapper to get valid json
s = content(d, as="text")
#     s=as.matrix(as.data.frame(s))
#     s=str_replace(s, "<", " ")
# city=as.data.frame(str_match_all(s,"city>([A-Z]*)</"))
# address = as.data.frame(str_match_all(s, "address1>([0-9 A-Z]*)</address1"))
lat=as.data.frame(str_match_all(s,"latitude>([0-9.0-9]*)</latitude"))
long=as.data.frame(str_match_all(s,"longitude>(-[0-9.0-9]*)</longitude"))
# phone=as.data.frame(str_match_all(s,"phone>([0-9]*)</phone"))
lat=lat[,2]
lat=as.data.frame(lat)
long=long[,2]
long=as.data.frame(long)
data.DC=cbind(lat=lat, long=long)

# Save the file locally
file = paste0("json/",name,".json")
write(s, file=file)




################### add them together and make the final data

data=rbind(data.UT, data.DC)
data=unique(data)

### This matches the number of Denny's restaurants in the US.











```


